#Test
services:
  api:
    image: keuzewijzer-api:${ENV_KEY}
    build:
      context: ./
      dockerfile: DockerfileApi
    ports:
      - "${API_PORT}:8080"
    volumes:
      - ./KeuzeWijzerCore.dll:/app/KeuzeWijzerCore.dll:r
    environment:
      ASPNETCORE_HTTP_PORTS: "8080"
      ASPNETCORE_ENVIRONMENT: ${ASPNETCORE_ENVIRONMENT}
      DB_CONNECTION_STRING: "Server=${DB_HOST};Database=${DB_NAME};User Id=${DB_USER};Password=${DB_PASSWORD};Encrypt=True;TrustServerCertificate=True"
    networks:
      - container_network

  mvc:
    image: keuzewijzer-mvc:${ENV_KEY}
    build:
      context: ./
      dockerfile: DockerfileMvc
    ports:
      - "${MVC_PORT}:8082"
    environment:
      ApiUri__ApiUri: "${ENV_KEY}-server-mvc-1:${API_PORT}"
      ASPNETCORE_HTTP_PORTS: "8082"
      ASPNETCORE_ENVIRONMENT: ${ASPNETCORE_ENVIRONMENT}
    networks:
      - container_network

networks:
  container_network:
    name: ${ENV_KEY}_network
    external: true
